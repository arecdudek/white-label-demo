{% extends "WLAppBundle::layout.html.twig" %}

{% block title %}
    {% for crumbs in breadcrumbs %}
        {{ crumbs.title }}
        {% if loop.last == false %}
            /
        {% endif %}
    {% endfor %}
    {% if pagination.currentPage > 1 %}(str. {{ pagination.currentPage }}){% endif %} - White Label Nokaut.pl
{% endblock %}

{% block desc %}
    {% for crumbs in breadcrumbs %}
        {{ crumbs.title }}
        {% if loop.last == false %}
            /
        {% endif %}
    {% endfor %}
{% endblock %}

{% block head %}
    {{ parent() }}

    <link rel="canonical" href="{{ url(route, { (routeArgument): canonical|trim('/')}) }}"/>
{% endblock %}

{% macro filterView(filter, includeRange, boxId, route, routeArgument) %}
    <div class="panel panel-default category-filter">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" href="#collapse{{ boxId }}" class="category-filter-title collapsed">
                    {{ filter.name }}
                    <i class="filter-open fa fa-angle-down"></i>
                    <i class="filter-close fa fa-angle-up"></i>
                </a>
            </h4>
        </div>
        <div id="collapse{{ boxId }}" class="panel-collapse {% if filter.isActive %}in{% else %}collapse{% endif %}" style="{% if filter.isActive %}height: auto;{% else %}height: 0;{% endif %};">
            <div class="panel-body">
                <ul>
                    {% set selectedValue = false %}
                    {% for value in filter %}
                        {% if value.isFilter %}
                            {% set selectedValue = value %}
                        {% endif %}
                        <li class="{% if value.isFilter %}active{% elseif value.total==0 %}disabled{% endif %}"><a href="{{ url(route, { (routeArgument) : value.url|trim('/')}) }}">
                                <span class="badge pull-right">{{ value.total }}</span> {{ value.name }} {{ filter.unit }}</a>
                        </li>
                    {% endfor %}

                    {% if includeRange %}
                        <li class="lower">
                            <form class="form" role="form">
                                <div class="input-group">
                                    <input value="{{ selectedValue ? selectedValue.min : '' }}" type="text" class="form-control input-sm" placeholder="od">
                                    <div class="input-group-addon">-</div>
                                    <input value="{{ selectedValue ? selectedValue.max : '' }}" type="text" class="form-control input-sm" placeholder="do">
                                    <div class="input-group-addon">PLN</div>
                                    <span class="input-group-btn pull-right filter-submit">
                                      <button class="btn btn-sm btn-link" type="button">zastosuj</button>
                                    </span>
                                </div>
                            </form>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>
{% endmacro %}
{% block content %}
    <div class="row category">

    <!-- filters -->
    <div class="col-md-3 col-sm-12 category-filters">
        <div class="panel-group" id="accordion">

            {{ _self.filterView(priceFilters, true, '-prices', route, routeArgument) }}
            {{ _self.filterView(producersFilters, false, '-producers', route, routeArgument) }}
            {% for filter in propertiesFilters if not filter.isExcluded %}
                {{ _self.filterView(filter, false, '-properites-' ~ loop.index, route, routeArgument) }}
            {% endfor %}

            {% if category.description %}
            <div class="panel panel-default category-filter">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" class="category-filter-title">
                            Opis
                            <i class="filter-open fa fa-angle-down"></i>
                            <i class="filter-close fa fa-angle-up"></i>
                        </a>
                    </h4>
                </div>
                <div id="collapseThree" class="panel-collapse collapse in">
                    <div class="panel-body">
                        {{ category.description|raw }}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>


    </div>



    <div class="col-md-9 col-sm-12">

    <div class="row category-details">
        <div class="col-xs-11">
            <h1>
                <span class="name">{{ category.title }} <small>{{ products.metadata.total|varietyProducts }}</small></span>
                {% for filter in selectedFilters if filter is not empty %}
                <span>
                    <span class="badge-name">{{ filter.name }}:</span>
                    {% for value in filter %}
                    <span class="badge">
                        <button type="button" onclick="document.location.href='{{ url('category', {'categoryUrlWithFilters': value.url|trim('/') }) }}'" class="close">×</button>
                        <span>{{ value.name }}</span>
                    </span>
                    {% endfor %}
                </span>
                {% endfor %}
            </h1>
        </div>
        <div class="col-xs-1 text-right options">

            <div class="btn-group">
                <a href="#" class="btn btn-link dropdown-toggle" data-toggle="dropdown">
                    <i class="fa fa-bars"></i>
                </a>
                <ul class="dropdown-menu dropdown-menu-right">
                    <li class="dropdown-header">Widok</li>
                    <li id="category-view-list"><a href="#list"><i class="fa fa-th-list"></i> lista</a></li>
                    <li id="category-view-grid" class="active"><a href="#box"><i class="fa fa-th"></i> kafle</a></li>
                    <li class="divider"></li>
                    <li class="dropdown-header">Sortowanie</li>

                    {% macro additionalSortIcon(sortName) %}
                        {% if sortName == 'domyślne' %}
                            {{ 'fa-long-arrow-down' }}
                        {% elseif sortName == 'od popularnych' %}
                            {{ 'fa-sort-amount-desc' }}
                        {% elseif sortName == 'od mało popularnych' %}
                            {{ 'fa-sort-amount-asc' }}
                        {% elseif sortName == 'od a do z' %}
                            {{ 'fa-sort-alpha-asc' }}
                        {% elseif sortName == 'od z do a' %}
                            {{ 'fa-sort-alpha-desc' }}
                        {% elseif sortName == 'od najtańszych' %}
                            {{ 'fa-sort-numeric-asc' }}
                        {% elseif sortName == 'od najdroższych' %}
                            {{ 'fa-sort-numeric-desc' }}
                        {% endif %}
                    {% endmacro %}

                    {% for sort in sorts %}
                        {% if sort.isFilter %}
                            <li class="active"><a href="{{ url(route, { (routeArgument) : sort.url|trim('/')}) }}"><i class="fa {{ _self.additionalSortIcon(sort.name) }}"></i> {{ sort.name }}</a></li>
                        {% else %}
                            <li><a href="{{ url(route, { (routeArgument) : sort.url|trim('/')}) }}"><i class="fa {{ _self.additionalSortIcon(sort.name) }}"></i> {{ sort.name }}</a></li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <div class="row category-products">

    {% for product in products %}
        {% if product.offerCount == 1 %}
            {% set productUrl = product|click %}
        {% else %}
            {% set productUrl = path('product', {'productUrl': product.url|trim('/')}) %}
        {% endif %}
        <!---- product starts here ---->
        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12 product-wrapper-grid">
            <div class="product normal">
                <a {% if product.offerCount == 1 %}target="_blank"{% endif %} href="{{ productUrl }}">
                    <div class="image">
                        <img class="img-responsive" src="{{ nokaut_img_domain ~ nokaut_photo_url.prepare(product.photoId, '500x500', product.title) }}" title="{{ product.title|raw }}" />
                    </div>
                </a>
                <div class="product-details">
                    <div class="row">
                        <div class="col-lg-9 col-sm-8 col-xs-12 title-features">
                            <a {% if product.offerCount == 1 %}target="_blank"{% endif %} href="{{ productUrl }}">
                                <h5 class="title">{{ product.title|raw }}</h5>
                            </a>
                            <div class="product-details-popup text-center">
                                <a {% if product.offerCount == 1 %}target="_blank"{% endif %} href="{{ productUrl }}" data-container="body" data-placement="left" data-toggle="tooltip" >
                                    <i class="fa fa-align-justify"></i>
                                    <div class="tooltip_title_wrapper hidden">
                                        <p>Food truck fixie...</p><p>locavore, accusamus mcsweeney's marfa nulla single-origin coffee squid. Exercitation +1 labore velit, blog sartorial PBR leggings next level wes anderson artisan four loko farm-to-table craft beer twee. Qui photo booth letterpress, commodo enim craft beer mlkshk aliquip jean shorts ullamco ad vinyl cillum PBR. Homo nostrud organic, assumenda labore aesthetic magna delectus mollit</p>
                                    </div>
                                </a>
                                {% set savePercent = helper_price.getSavePercent(product.prices) %}
                                {% if savePercent > 0 %}
                                    <a {% if product.offerCount == 1 %}target="_blank"{% endif %} href="{{ productUrl }}" data-container="body" data-placement="left" data-toggle="tooltip">
                                        <i class="fa fa-tag"></i>

                                        <div class="tooltip_title_wrapper hidden">
                                            Na tym produkcie możesz zaoszczędzić aż  {{ savePercent }}%
                                        </div>
                                    </a>
                                {% endif %}
                                {% if product.offerCount == 1 %}
                                    <a href="{{ url('product', {'productUrl': product.url|trim('/') }) }}"><i class="fa fa-link"></i></a>
                                {% endif %}
                            </div>
                            <ul class="features">
                                <li>Styl: <em>sportowy, sportowy</em></li>
                                <li>Mechanizm: <em>kwarcowy</em></li>
                            </ul>
                        </div>
                        <div class="col-lg-3 col-sm-4 col-xs-12 price">
                            <a {% if product.offerCount == 1 %}target="_blank"{% endif %} href="{{ productUrl }}"><span class="price lead">{{ product.prices.min|number_format(2,',',' ') }} PLN</span></a>
                            <a {% if product.offerCount == 1 %}target="_blank"{% endif %} href="{{ productUrl }}" class="btn btn-success btn-success-outlined btn-icon-right">Porównaj oferty <i class="fa fa-angle-right"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!---- product ends here ---->
    {% else %}
        <div class="alert alert-warning" role="alert">Brak produktów z wybranymi filrami</div>
    {% endfor %}








    </div>
    <div class="row">
        <div class="col-xs-12 text-center">
            {% include '@WLApp/paginator.html.twig' %}
        </div>
    </div>

    </div>


    </div>

{% endblock %}

